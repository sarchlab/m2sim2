# SPEC CPU 2017 Configuration for M2Sim ARM64 Benchmarks
# [Bob] Created for M2Sim benchmark validation
#
# This config builds ARM64 binaries for use with M2Sim simulator.
# Binaries are built with minimal optimizations to keep simulation tractable.
#
# Usage:
#   cd $SPEC_ROOT
#   source shrc
#   runcpu --config=arm64-m2sim --action=build --tune=base 557.xz_r

# ============================================================================
# Compiler settings
# ============================================================================

%define build_ncpus 8
makeflags = -j%{build_ncpus}

# Label for binaries (appears in exe/*.arm64)
label = arm64

# Use clang for ARM64 compilation
# On macOS ARM64 (Apple Silicon), use native clang
# For cross-compilation, set CC/CXX to cross-compiler paths
default:
   CC           = clang
   CXX          = clang++
   FC           = flang

# Target ARM64 architecture
# -target is for cross-compilation; remove if building natively on ARM64
default:
   OPTIMIZE     = -O2
   COPTIMIZE    = 
   CXXOPTIMIZE  = 
   FOPTIMIZE    = 

# ARM64 specific flags
# Using -O2 for reasonable performance while keeping simulation time manageable
# Avoid -O3 or aggressive optimizations that create complex instruction sequences
default:
   EXTRA_CFLAGS    = -mcpu=apple-m2
   EXTRA_CXXFLAGS  = -mcpu=apple-m2
   EXTRA_FFLAGS    = 

# Portability settings for various benchmarks
default:
   PORTABILITY  = -DSPEC_LP64

# 505.mcf_r portability
505.mcf_r:
   CPORTABILITY = -DSPEC_LP64

# 525.x264_r portability  
525.x264_r:
   CPORTABILITY = -DSPEC_LP64

# 557.xz_r portability
557.xz_r:
   CPORTABILITY = -DSPEC_LP64

# ============================================================================
# Runtime settings (for reference - M2Sim runs binaries directly)
# ============================================================================

intrate:
   copies = 1

fprate:
   copies = 1

# ============================================================================
# Monitoring and output
# ============================================================================

default:
   output_format = txt
   teeout        = yes

# ============================================================================
# Notes
# ============================================================================

notes_plat_000 = Built for M2Sim Apple M2 simulator
notes_plat_005 = ARM64 architecture, clang compiler
notes_plat_010 = Optimized with -O2 for simulation tractability
